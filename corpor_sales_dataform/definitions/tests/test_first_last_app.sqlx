config {
    type: "test",
    dataset: "item_sales_first_last_app_2017614"
}

input "partitioned_item_data" {
    SELECT 10 AS item_nbr, DATE '2017-6-13' AS date, 15 AS unit_sales, 5 AS onpromotion
    UNION ALL
    SELECT 10, DATE '2017-6-11', 20, 3
    UNION ALL
    SELECT 10, DATE '2017-6-07', 17, 8
    UNION ALL
    SELECT 20, DATE '2017-6-12', 11, 2
    UNION ALL
    SELECT 20, DATE '2017-6-10', 12, 5
}

SELECT 
  10 AS item_nbr,
  0 AS item_last_sales_app_past_7_days,
  7 AS item_first_sales_app_past_7_days,
  3 AS item_has_sales_in_last_7_days,
  3.0 / 7 AS item_percent_days_with_sales_last_7_days
UNION ALL
  SELECT 20, 1, 4, 2, 2.0 / 7