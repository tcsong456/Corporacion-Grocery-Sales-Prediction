config { type: "view" }

js {    
    const promo_window = require("includes/promo_window_sales.js");
    const windows = [3, 7, 14, 30, 60, 140];
    const targetDate = '2017-6-28';
    const columns = windows.map(w => promo_window(targetDate,w)).join(",\n")
}

SELECT
  store_nbr,
  item_nbr,
  ${columns}
FROM ${ref("partitioned_full_data")}
GROUP BY store_nbr,item_nbr