FROM python:3.10-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
  unzip \
  p7zip-full \
  dos2unix \
  google-cloud-sdk \
  curl && \
  rm -rf /var/lib/apt/lists/*

RUN pip install kaggle

WORKDIR /app
COPY kaggle.json /root/.kaggle/kaggle.json
COPY shell_scripts/data_download.sh .
COPY shell_scripts/run_terraform.sh .

RUN dos2unix data_download.sh run_terraform.sh && \
    chmod 600 /root/.kaggle/kaggle.json && \
    chmod +x data_download.sh run_terraform.sh
#CMD ["./data_download.sh"]
CMD bash -c "./data_download.sh && ./run_terraform.sh"